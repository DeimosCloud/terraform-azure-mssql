# MSSQL Azure
A terraform module  for MSSQL Database creation


## Basic Usage

```hcl
module "mssql" {
  source = "git::https://gitlab.com/deimosdev/tooling/terraform-modules/terraform-mssql-azure"

  database_name       = "test"
  resource_group_name = azurerm_resource_group.resource_group.name

  tags = {
    environment = "TEST"
    costcenter  = "it"
    managed     = "terraform"
  }
}
```

### Creating vnet firewall rule
Generates the vnet rule name by default, or a vnet-rule name to use can be optionally passed

```hcl
module "mssql" {
  source = "git::https://gitlab.com/deimosdev/tooling/terraform-modules/terraform-mssql-azure"

  database_name       = "test"
  resource_group_name = azurerm_resource_group.resource_group.name
  create_vnet_rule    = true
  subnet_id           = var.subnet_id  # The subnet must have Microsoft.Sql service endpoint enabled

  tags = {
    environment = "TEST"
    costcenter  = "it"
    managed     = "terraform"
  }
}
```

### Creating Private link Endpoints
Generates the private link endpoint name by default, or a private-link endpoint name to use can be optionally passed

```hcl
module "mssql" {
  source = "git::https://gitlab.com/deimosdev/tooling/terraform-modules/terraform-mssql-azure"

  database_name           = "test"
  resource_group_name     = azurerm_resource_group.resource_group.name
  create_private_endpoint = true
  subnet_id               = var.subnet_id  # The subnet must enable private link endpoints

  tags = {
    environment = "TEST"
    costcenter  = "it"
    managed     = "terraform"
  }
}
```

## Requirements

| Name | Version |
|------|---------|
| terraform | >= 0.12 |
| azurerm | >= 2.1.0 |
| local | >= 1.2 |
| random | >= 2.1 |

## Providers

| Name | Version |
|------|---------|
| azurerm | >= 2.1.0 |
| random | >= 2.1 |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| admin\_login\_name | The administrator login name for the SQL Server | `string` | `""` | no |
| allow\_access\_to\_azure\_services | Makes server accessible to Authenticated requests from Azure services | `bool` | `false` | no |
| clients\_ip | A list of client IPs to be whitelisted for access to SQL Server. Example [{start\_ip: 0.0.0.0, end\_ip: 0.0.0.1},] | `list(map(string))` | `[]` | no |
| create\_private\_endpoint | Whether to create a private endpoint access for the SQL Server. The subnet id must be provided ifthis is true | `bool` | `false` | no |
| create\_vnet\_rule | whether to create the vnet rule | `bool` | `false` | no |
| database\_name | The name of the Ms SQL Database. Changing this forces a new resource to be created. | `any` | n/a | yes |
| max\_size\_gb | the max size of the database in gigabytes. | `number` | `20` | no |
| private\_dns\_zone\_name | The Private DNS Zone to use to create the Private FQDN for the SQL server if private. Once specified, an FQDN is created for the Private Link | `any` | `null` | no |
| private\_endpoint\_name | The name of the private endpoint to be created. If not provided it is autogenerated when create\_private\_endpoint is true | `string` | `""` | no |
| private\_fqdn\_subdomain | The subdomain to deploy database on for the private\_dns\_zone | `string` | `".database"` | no |
| public\_network\_access\_enabled | Whether or not public network access is allowed for this server | `bool` | `false` | no |
| resource\_group\_name | The name of the resource group where the SQL server resides | `any` | n/a | yes |
| server\_name | The name of the server to be created | `string` | `""` | no |
| server\_version | The version of the MSSQL server. | `string` | `"12.0"` | no |
| subnet\_id | The subnet id to attach private\_endpoint/vnet firewall rule to. For Vnet firewall rule, The subnet passed must have the Microsoft.Sql service endpoint enabled | `string` | `""` | no |
| tags | Tags to be passed to created instances | `map` | `{}` | no |
| vnet\_rule\_name | The name of the SQL virtual network rule to be created | `string` | `""` | no |

## Outputs

| Name | Description |
|------|-------------|
| database\_name | The name of the created database |
| private\_endpoint\_ip\_address | The private IP address associated with the private endpoint |
| private\_fqdn | The private FQDN of the SQL Server based on the associated Private Endpoint |
| private\_link\_endpoint\_id | The ID of the private endpoint |
| private\_link\_endpoint\_name | The name of the private endpoint |
| server\_administrator\_login | Administrator Login username |
| server\_administrator\_login\_password | Administration login password |
| server\_domain\_name | The fully qualified domain name of the Azure SQL Server (e.g. myServerName.database.windows.net |
| server\_id | The id of the server the MSSQL database was provisioned on |
| server\_name | The name of the server the MSSQL database was provisioned on |
| vnet\_rule\_id | The ID of the SQL virtual network rule |
